{% extends "emails/base_email.html" %}

{% block title %}Promemoria: Scadenza Imminente - {{ lottery.title }}{% endblock %}

{% block content %}
<h2>‚è∞ Scadenza Imminente!</h2>

<p>Ciao <strong>{{ user.first_name|default:user.username }}</strong>,</p>

{% if notification_type == 'lottery_ending_soon' %}
    <p>Questo √® un promemoria che la lotteria "<strong>{{ lottery.title }}</strong>" sta per scadere!</p>
    
    <div class="warning-box">
        <h3>‚è≥ Tempo Rimanente: {{ time_remaining }}</h3>
        <p>Se vuoi partecipare, devi acquistare un biglietto prima della scadenza!</p>
    </div>
{% elif notification_type == 'lottery_expiring_today' %}
    <p><strong>ATTENZIONE:</strong> La lotteria "<strong>{{ lottery.title }}</strong>" scade <strong>OGGI</strong>!</p>
    
    <div class="error-box">
        <h3>üö® Scade Oggi!</h3>
        <p>Hai solo alcune ore per partecipare!</p>
    </div>
{% endif %}

<div class="lottery-details">
    <div class="lottery-title">üìã Dettagli Lotteria</div>
    
    <div class="lottery-info">
        <div class="lottery-info-row">
            <div class="lottery-info-cell">Titolo:</div>
            <div class="lottery-info-cell">{{ lottery.title }}</div>
        </div>
        <div class="lottery-info-row">
            <div class="lottery-info-cell">Valore in Palio:</div>
            <div class="lottery-info-cell">‚Ç¨{{ lottery.item_value }}</div>
        </div>
        <div class="lottery-info-row">
            <div class="lottery-info-cell">Prezzo Biglietto:</div>
            <div class="lottery-info-cell">‚Ç¨{{ lottery.ticket_price }}</div>
        </div>
        <div class="lottery-info-row">
            <div class="lottery-info-cell">Biglietti Rimasti:</div>
            <div class="lottery-info-cell">
                {% if lottery.items_count > lottery.tickets_sold %}
                    <strong style="color: #dc3545;">{{ lottery.items_count|add:"-"|add:lottery.tickets_sold }}</strong>
                {% else %}
                    <span style="color: #28a745;">SOLD OUT!</span>
                {% endif %}
            </div>
        </div>
        <div class="lottery-info-row">
            <div class="lottery-info-cell">Scadenza:</div>
            <div class="lottery-info-cell">
                <strong>{{ lottery.expiration_date|date:"d/m/Y H:i" }}</strong>
                {% if notification_type == 'lottery_ending_soon' %}
                    <br><small style="color: #dc3545;">(Tra {{ time_remaining }})</small>
                {% endif %}
            </div>
        </div>
        <div class="lottery-info-row">
            <div class="lottery-info-cell">Venditore:</div>
            <div class="lottery-info-cell">{{ lottery.seller.get_full_name|default:lottery.seller.username }}</div>
        </div>
    </div>
</div>

{% if lottery.items_count > lottery.tickets_sold %}
    <h3>üéØ Ultima Chance!</h3>
    
    <div class="info-box">
        <h4>üí´ Perch√© Partecipare:</h4>
        <ul>
            <li><strong>Prezzo accessibile:</strong> Solo ‚Ç¨{{ lottery.ticket_price }} per tentare la fortuna</li>
            <li><strong>Premio di valore:</strong> ‚Ç¨{{ lottery.item_value }} in palio</li>
            <li><strong>Trasparenza totale:</strong> Estrazione verificabile e sicura</li>
            <li><strong>Tempo limitato:</strong> Questa √® davvero l'ultima occasione!</li>
        </ul>
    </div>

    <div style="text-align: center; margin: 30px 0;">
        <a href="{{ site_url }}{% url 'mercato_lotteries:detail' lottery.id %}" class="btn">Acquista Subito!</a>
    </div>

    <div class="warning-box">
        <h4>‚ö†Ô∏è Non Aspettare!</h4>
        <p>Ricorda che:</p>
        <ul>
            <li>L'acquisto richiede pochi secondi</li>
            <li>I biglietti sono numerati e unici</li>
            <li>Una volta che la lotteria scade, non sar√† pi√π possibile partecipare</li>
            <li>Pi√π tempo aspetti, meno probabilit√† hai di trovare ancora biglietti disponibili</li>
        </ul>
    </div>
{% else %}
    <div class="success-box">
        <h3>üéâ Lotteria SOLD OUT!</h3>
        <p>Fantastico! Questa lotteria ha raggiunto il numero massimo di biglietti venduti.</p>
        <p>L'estrazione avverr√† automaticamente a breve!</p>
    </div>
{% endif %}

{% if notification_type == 'lottery_expiring_today' %}
    <div style="text-align: center; margin: 30px 0;">
        <div style="background-color: #dc3545; color: white; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <h3 style="margin: 0; color: white;">üö® SCADE OGGI! üö®</h3>
            <p style="margin: 5px 0;">Non perdere questa opportunit√†!</p>
        </div>
    </div>
{% endif %}

<div class="info-box">
    <h4>üîî Hai Ricevuto Questa Email Perch√©:</h4>
    <p>Hai visitato questa lotteria o hai mostrato interesse per categorie simili. Vuoi disattivare queste notifiche?</p>
</div>

<div style="text-align: center; margin: 30px 0;">
    <a href="{{ site_url }}{% url 'accounts:notifications' %}" class="btn" style="background-color: #6c757d;">Gestisci Notifiche</a>
</div>

<p>Grazie per aver scelto MercatoPro!</p>

<p>Il Team di MercatoPro</p>
{% endblock %}