# BLE Penetration Testing Tools

This directory contains tools, documentation, and examples for conducting Bluetooth Low Energy (BLE)
penetration testing and security assessment.

## Overview

The BLE penetration testing toolkit provides comprehensive functionality for:

- **Device Discovery and Enumeration**: Identify and catalog BLE devices and their services
- **Pairing Analysis**: Evaluate BLE pairing mechanisms for vulnerabilities
- **MITM Detection**: Assess susceptibility to man-in-the-middle attacks
- **Protocol Fuzzing**: Test protocol robustness with malformed inputs
- **Replay Attack Detection**: Identify replay vulnerabilities
- **Comprehensive Reporting**: Generate detailed findings with recommendations

## Quick Start

### Installation

Install the required dependencies:

```bash
pip install -r requirements-ble.txt
```

Or install as an optional dependency in conda:

```bash
pip install conda[ble-pentest]
```

### Basic Usage

1. **Prepare a configuration file** (see `examples/` directory):

```bash
cp examples/config_example.yaml my_config.yaml
# Edit my_config.yaml with your target information
```

2. **Run a scan**:

```bash
python -m ble_pentest scan --config my_config.yaml --output results.json
```

3. **Review results**:

```bash
cat results.json
```

## Structure

```
tools/ble_pentest/
├── README.md                    # This file
├── requirements-ble.txt         # Python dependencies
└── examples/
    ├── config_example.yaml      # Annotated configuration template
    ├── config_minimal.yaml       # Minimal configuration example
    ├── config_safety_first.yaml  # Safety-focused configuration
    └── reports/
        ├── scan_report_example.json      # Sample scan output
        ├── pairing_report_example.json   # Sample pairing analysis
        └── fuzzing_report_example.json   # Sample fuzzing results
```

## Documentation

For comprehensive documentation, see:

- **Full Guide**: `docs/source/dev-guide/ble-penetration.rst`
- **Configuration Schema**: See the configuration examples in `examples/`
- **Safety Guidelines**: Read the safety section in the full guide
- **Attack Workflows**: Each attack type has detailed workflow documentation

## Examples

### Example 1: Device Enumeration

```yaml
# config_scan.yaml
global:
  verbose: false
  discovery_timeout: 15

attack:
  type: "scan"
  timeout: 20

reporting:
  format: "json"
  output_file: "devices_found.json"

scope:
  authorized_names:
    - "*"
```

Run with:
```bash
python -m ble_pentest scan --config config_scan.yaml
```

### Example 2: Pairing Analysis

```yaml
# config_pairing.yaml
target:
  address: "AA:BB:CC:DD:EE:FF"

attack:
  type: "pairing"
  timeout: 20
  max_retries: 3

reporting:
  format: "json"
  include_recommendations: true
  output_file: "pairing_analysis.json"

scope:
  authorized_addresses:
    - "AA:BB:CC:DD:EE:FF"
```

Run with:
```bash
python -m ble_pentest pairing --config config_pairing.yaml
```

### Example 3: Fuzzing with Safety

```yaml
# config_fuzzing_safe.yaml
target:
  address: "AA:BB:CC:DD:EE:FF"
  characteristics:
    - "2A18"  # Body Sensor Location

attack:
  type: "fuzzing"
  timeout: 60

reporting:
  format: "html"
  include_captures: false
  output_file: "fuzzing_report.html"

scope:
  authorized_addresses:
    - "AA:BB:CC:DD:EE:FF"
```

Run with:
```bash
python -m ble_pentest fuzz --config config_fuzzing_safe.yaml
```

## Report Generation

### Generating Different Report Formats

**JSON (Default)**
```bash
python -m ble_pentest scan --config config.yaml \
  --format json --output report.json
```

**HTML with Styling**
```bash
python -m ble_pentest pairing --config config.yaml \
  --format html --output pairing_report.html
```

**PDF with Recommendations**
```bash
python -m ble_pentest fuzzing --config config.yaml \
  --format pdf --include-recommendations --output findings.pdf
```

### Understanding Reports

Each report contains:

1. **Executive Summary**: High-level findings and critical issues
2. **Methodology**: Attack type, configuration, and scope details
3. **Findings**: Categorized by severity (CRITICAL, HIGH, MEDIUM, LOW, INFO)
4. **Recommendations**: Prioritized remediation steps
5. **Appendices**: Configuration, logs, and optional packet captures

### Sample Reports

See `examples/reports/` for sample output from each attack type:

- `scan_report_example.json`: Device discovery findings
- `pairing_report_example.json`: Pairing mechanism analysis
- `fuzzing_report_example.json`: Protocol robustness testing results

## Safety and Legal

**Before conducting any BLE penetration testing:**

1. **Obtain Authorization**: Get explicit written permission from the device owner
2. **Understand Regulations**: BLE testing is subject to local RF regulations
3. **Define Scope**: Clearly specify authorized target devices
4. **Isolate Testing**: Use isolated environments (Faraday cages if possible)
5. **Audit All Activities**: All tests are logged for accountability

### Authorization Configuration

Ensure your configuration limits testing to authorized devices:

```yaml
scope:
  # Option 1: Specific device addresses
  authorized_addresses:
    - "AA:BB:CC:DD:EE:FF"
    - "11:22:33:44:55:66"
  
  # Option 2: Device name patterns
  authorized_names:
    - "TestDevice*"
    - "Lab-*"
  
  # Option 3: MAC address ranges
  authorized_ranges:
    - "AA:BB:CC:00:00:00/AA:BB:CC:FF:FF:FF"
```

### Prohibited Actions

- Testing devices not explicitly authorized
- Extracting personal data from devices
- Causing permanent device damage
- Disrupting critical or safety systems
- Testing without proper authorization

## Troubleshooting

### Device Not Discovered

- Verify device is powered on and in range
- Ensure BLE adapter is functional (`hciconfig` on Linux)
- Check for sufficient signal strength
- Try increasing `discovery_timeout`

### Connection Failures

- Verify device address is correct
- Ensure device is not already connected elsewhere
- Check for pairing requirements
- Try increasing timeout values

### Report Generation Issues

- Ensure output directory exists
- Verify sufficient disk space
- Check file permissions
- Try different output format if file generation fails

### Fuzzing Causes Device Crashes

- Reduce testing intensity in configuration
- Use validated fuzzing payloads first
- Increase delay between fuzzing attempts
- Test on non-critical devices first

## Prerequisites

### System Requirements

- **OS**: Linux, macOS, or Windows with Bluetooth support
- **Python**: 3.8+
- **BLE Hardware**: Built-in or USB BLE adapter

### Platform-Specific Setup

**Linux**:
```bash
# Install BlueZ
sudo apt-get install bluez bluez-tools python3-dev

# Enable BLE adapter
sudo hciconfig hci0 up
```

**macOS**:
- Built-in BLE support via CoreBluetooth
- No additional setup needed

**Windows**:
- Windows 10+ with native BLE support
- Or configure USB adapter with Zadig

## Dependencies

All required packages are listed in `requirements-ble.txt`:

- **bleak**: Cross-platform BLE library
- **Frida**: Dynamic instrumentation toolkit
- Platform-specific BLE libraries

Install with:
```bash
pip install -r requirements-ble.txt
```

## Configuration Reference

See `examples/` for configuration templates:

- `config_example.yaml`: Full configuration with all options
- `config_minimal.yaml`: Minimal example for quick start
- `config_safety_first.yaml`: Configuration emphasizing safety

For complete configuration documentation, see the full guide in `docs/source/dev-guide/ble-penetration.rst`.

## Support

For detailed guidance on:

- **Attack Workflows**: See the full guide's "Attack Workflows" section
- **Interpreting Findings**: See "Report Generation and Interpretation"
- **Safety Practices**: See "Safety Considerations" section
- **Advanced Topics**: See "Advanced Topics" in the full guide

## Contributing

When adding new attack types or features:

1. Add configuration examples to `examples/`
2. Create sample reports in `examples/reports/`
3. Document the attack workflow in the guide
4. Include safety considerations
5. Provide clear examples of proper configuration

## License

These tools are provided as part of the conda project. See the main conda LICENSE file for details.
