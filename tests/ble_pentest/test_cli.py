from __future__ import annotations

from typing import TYPE_CHECKING

from tools.ble_pentest import cli
from tools.ble_pentest.config import BlePentestConfig

if TYPE_CHECKING:
    from pathlib import Path


def test_parse_args_wires_config_and_output_dir(tmp_path: Path):
    config_path = tmp_path / "cfg.yml"
    config_path.write_text("attacks: {noop: true}\n", encoding="utf-8")

    args = cli.parse_args(
        ["--config", str(config_path), "--out", str(tmp_path / "out")]
    )
    assert args.config == config_path
    assert args.output_dir == tmp_path / "out"


def test_select_attack_names_defaults_to_enabled_attacks():
    cfg = BlePentestConfig(attacks={"noop": True, "echo_targets": False})
    assert cli.select_attack_names(cfg, None) == ("noop",)


def test_select_attack_names_respects_requested_list():
    cfg = BlePentestConfig(attacks={"noop": True, "echo_targets": False})
    assert cli.select_attack_names(cfg, ["echo_targets"]) == ("echo_targets",)
