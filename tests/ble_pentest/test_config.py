from __future__ import annotations

from typing import TYPE_CHECKING

from tools.ble_pentest.config import load_ble_config

if TYPE_CHECKING:
    from pathlib import Path


def test_load_ble_config_parses_targets_credentials_and_attacks(tmp_path: Path):
    config_path = tmp_path / "ble.yml"
    config_path.write_text(
        """
        targets:
          - name: dev1
            address: '11:22:33:44:55:66'
          - 'AA:BB:CC:DD:EE:FF'
        credentials:
          pin: '0000'
        attacks:
          noop: true
          echo_targets: false
        attack_modules: ['some.module']
        """.lstrip(),
        encoding="utf-8",
    )

    cfg = load_ble_config(config_path)
    assert [t.address for t in cfg.targets] == [
        "11:22:33:44:55:66",
        "AA:BB:CC:DD:EE:FF",
    ]
    assert cfg.targets[0].name == "dev1"
    assert cfg.credentials == {"pin": "0000"}
    assert cfg.attacks == {"noop": True, "echo_targets": False}
    assert cfg.enabled_attacks() == ("noop",)
    assert cfg.attack_modules == ("some.module",)
